

spi:
  id: hspi
  clk_pin: GPIO14
  mosi_pin: GPIO13
  miso_pin: GPIO12


## CLAUDE 11/9 - Add PWM output for brightness control
output:
  - platform: ledc
    pin: GPIO27
    id: lcd_backlight
    frequency: 1000Hz

# Add a number component to control brightness
number:
  - platform: template
    name: "Screen Brightness"
    id: screen_brightness
    min_value: 0
    max_value: 100
    step: 5
    initial_value: 10
    optimistic: true
    set_action:
      - output.set_level:
          id: lcd_backlight
          level: !lambda 'return x / 100.0;'

display:
  - platform: ili9xxx
    id: lcd
    spi_id: hspi
    model: ST7796
    dimensions:
      width: 320
      height: 480
    rotation: 270  # USB in from the left
    cs_pin: GPIO15
    dc_pin: GPIO2
    color_order: BGR
    invert_colors: false
    spi_mode: MODE0
    color_palette: 8BIT
    data_rate: 20MHz
    auto_clear_enabled: false
    update_interval: never

# Time component for timestamp
time:
  - platform: homeassistant
    id: homeassistant_time

### SENSORS FROM HA
sensor:
 ## Physical sensors in home (temp/humid)
  - platform: homeassistant
    id: backyard_temperature
    entity_id: sensor.backyard_temperature
  - platform: homeassistant
    id: backyard_humidity
    entity_id: sensor.backyard_humidity
  - platform: homeassistant
    id: living_room_temperature
    entity_id: sensor.living_room_temperature
  - platform: homeassistant
    id: living_room_humidity
    entity_id: sensor.living_room_humidity

## DOCKY STATUS
  - platform: homeassistant
    id: docky_cpu_used
    entity_id: sensor.qemu_docky_1006_cpu_used   ## not using this one on pic
  - platform: homeassistant
    id: docky_download_speed
    entity_id: sensor.docky_combined_download_speed


## Outside conditions - AQI, forecast, etc.
  - platform: homeassistant
    id: aqi_value
    entity_id: sensor.u_s_air_quality_index
  - platform: homeassistant
    id: forecast_high
    entity_id: sensor.forecast_high
  - platform: homeassistant
    id: forecast_low
    entity_id: sensor.forecast_low
  - platform: homeassistant
    id: forecast_current_temp
    entity_id: sensor.forecast_current_temp
  - platform: homeassistant
    id: forecast_current_wind
    entity_id: sensor.forecast_current_wind  ## not in use
  - platform: homeassistant
    id: forecast_day_0_precip_inches
    entity_id: sensor.forecast_day_0_precip_inches

 
 # Forecast day 1 (tomorrow)
  - platform: homeassistant
    id: forecast_day_1_high
    entity_id: sensor.forecast_day_1_high
  - platform: homeassistant
    id: forecast_day_1_low
    entity_id: sensor.forecast_day_1_low
  - platform: homeassistant
    id: forecast_day_1_precip_inches
    entity_id: sensor.forecast_day_1_precip_inches

 # Forecast day 2
  - platform: homeassistant
    id: forecast_day_2_high
    entity_id: sensor.forecast_day_2_high
  - platform: homeassistant
    id: forecast_day_2_low
    entity_id: sensor.forecast_day_2_low
  - platform: homeassistant
    id: forecast_day_2_precip_inches
    entity_id: sensor.forecast_day_2_precip_inches


text_sensor:
  - platform: homeassistant
    id: aqi_level
    entity_id: sensor.u_s_air_pollution_level
  - platform: homeassistant
    id: forecast_condition_name
    entity_id: sensor.forecast_condition_name
  - platform: homeassistant
    id: forecast_day_0_date
    entity_id: sensor.forecast_day_0_date
  - platform: homeassistant
    id: forecast_day_1_date
    entity_id: sensor.forecast_day_1_date
  - platform: homeassistant
    id: forecast_day_2_date
    entity_id: sensor.forecast_day_2_date 
  - platform: homeassistant
    id: forecast_day_3_date
    entity_id: sensor.forecast_day_3_date 
  - platform: homeassistant
    id: forecast_condition
    entity_id: sensor.forecast_condition
  - platform: homeassistant
    id: forecast_day_1_condition
    entity_id: sensor.forecast_day_1_condition  
  - platform: homeassistant
    id: forecast_day_2_condition
    entity_id: sensor.forecast_day_2_condition 
  - platform: homeassistant
    id: forecast_day_3_condition
    entity_id: sensor.forecast_day_3_condition

## MOST RECENT 3 GRABS FROM SONARR - USES GOTIFY - struggling with radarr, sonarr works
  - platform: homeassistant
    id: arr_grab_1
    entity_id: sensor.arr_recent_grabs_short
    attribute: grab_1  
  - platform: homeassistant
    id: arr_grab_2
    entity_id: sensor.arr_recent_grabs_short
    attribute: grab_2    
  - platform: homeassistant
    id: arr_grab_3
    entity_id: sensor.arr_recent_grabs_short
    attribute: grab_3

## Water and thermo mdi icons ##

font:
  - file: "fonts/RobotoCondensed-Regular.ttf"
    id: text_with_icons_18
    size: 18
    bpp: 4
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: [
          "\U000F050F",  # mdi-thermometer
          "\U000F058C",  # mdi-water
          "\U000F0E0A",  # mdi-water-outline
          "\U000F059D",  # mdi-weather-windy
        ]
  - file: "fonts/RobotoCondensed-Regular.ttf"
    id: text_with_icons_20
    size: 20
    bpp: 4
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: [
          "\U000F050F",  # mdi-thermometer
          "\U000F058C",  # mdi-water
          "\U000F0E0A",  # mdi-water-outline
          "\U000F059D",  # mdi-weather-windy
        ]
  - file: "fonts/RobotoCondensed-Regular.ttf"
    id: weather_icons_40
    size: 40
    bpp: 4
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: [
          "\U000F0590",  # mdi-weather-cloudy
          "\U000F0591",  # mdi-weather-fog
          "\U000F0592",  # mdi-weather-hail
          "\U000F0593",  # mdi-weather-lightning
          "\U000F067E",  # mdi-weather-lightning-rainy
          "\U000F0594",  # mdi-weather-night
          "\U000F0595",  # mdi-weather-partly-cloudy
          "\U000F0596",  # mdi-weather-pouring
          "\U000F0597",  # mdi-weather-rainy
          "\U000F0598",  # mdi-weather-snowy
          "\U000F067F",  # mdi-weather-snowy-rainy
          "\U000F0599",  # mdi-weather-sunny
          "\U000F059D",  # mdi-weather-windy
          "\U000F059E",  # mdi-weather-windy-variant
        ]
  - file: "fonts/RobotoCondensed-Regular.ttf"
    id: weather_icons_48
    size: 48
    bpp: 4
    extras:
      - file: "fonts/materialdesignicons-webfont.ttf"
        glyphs: [
          "\U000F0590",  # mdi-weather-cloudy
          "\U000F0591",  # mdi-weather-fog
          "\U000F0592",  # mdi-weather-hail
          "\U000F0593",  # mdi-weather-lightning
          "\U000F067E",  # mdi-weather-lightning-rainy
          "\U000F0594",  # mdi-weather-night
          "\U000F0595",  # mdi-weather-partly-cloudy
          "\U000F0596",  # mdi-weather-pouring
          "\U000F0597",  # mdi-weather-rainy
          "\U000F0598",  # mdi-weather-snowy
          "\U000F067F",  # mdi-weather-snowy-rainy
          "\U000F0599",  # mdi-weather-sunny
          "\U000F059D",  # mdi-weather-windy
          "\U000F059E",  # mdi-weather-windy-variant
          "\U000F0868",  # mdi-docker
        ]

## MAIN LVGL SECTION: ##

lvgl:
  buffer_size: 25%

# Dark background style
  style_definitions:
    - id: dark_bg
      bg_color: 0x0a0a0a
      bg_opa: COVER
      text_color: 0xFFFFFF

  pages:
    - id: main_page
      bg_color: 0x0a0a0a
      widgets:
## CLOCK AND DATE
        - label:
            id: date_display
            text: "Loading..."
            align: TOP_MID
            x: -115
            y: 15
            text_font: montserrat_20
            text_color: 0xFFFF00
        - label:
            id: time_display
            text: "--:--"
            align: TOP_MID
            x: -115
            y: 40
            text_font: montserrat_48
            text_color: 0xFFFFFF
        - label:
            text: "T"
            align: TOP_LEFT
            x: 360
            y: 5
            text_font: montserrat_22
            text_color: 0xFFCCCC
        - label:
            text: "H"
            align: TOP_LEFT
            x: 420
            y: 5
            text_font: montserrat_22
            text_color: 0xCCFFFF 
        - obj:
            align: TOP_RIGHT
            x: -20
            y: 30
            width: 200
            height: 1
            bg_color: 0x444444
            border_width: 0
## HOUSE SENSORS RAW        
        - label:
            text: "Here"
            align: TOP_LEFT
            x: 265
            y: 40
            text_font: montserrat_24
            text_color: 0x00FF00
        - label:
            id: living_room_temperature_label
            text: "-"
            align: TOP_LEFT
            x: 350
            y: 33
            text_font: montserrat_38
        - label:
            id: living_room_humidity_label
            text: "-"
            align: TOP_LEFT
            x: 420
            y: 39
            text_font: montserrat_16

  ## ARR FEED
        - label:
            text: "\U000F0868"
            align: TOP_MID
            x: -190
            y: 130
            text_font: weather_icons_48
            text_color: 0x33D6FF 
        - label:
            id: docky_download_speed_label
            text: "MB/s"
            align: TOP_MID
            x: -190
            y: 180
            text_font: montserrat_16
            text_color: 0x33D6FF 

        - label:
            text: "Catch of the Day"
            align: TOP_LEFT
            x: 85
            y: 110
            text_font: montserrat_20
            text_color: 0x00FF00 
        - label:
            id: arr_grab_1_label
            text: "-"
            align: TOP_LEFT
            x: 100
            y: 135
            text_font: montserrat_18
            text_color: 0xFFFFFF 
        - label:
            id: arr_grab_2_label
            text: "-"
            align: TOP_LEFT
            x: 100
            y: 157
            text_font: montserrat_18
            text_color: 0xFFFFFF
        - label:
            id: arr_grab_3_label
            text: "-"
            align: TOP_LEFT
            x: 100
            y: 179
            text_font: montserrat_18
            text_color: 0xFFFFFF


  ## WEATHER SECTION ACROSS BOTTOM   

    # CURRENT CONDITIONS (LEFT CORNER) 
        - label:
            text: "Now"
            align: TOP_LEFT
            x: 10
            y: 225
            text_font: montserrat_22
            text_color: 0xFFFF00 
        - label:
            id: forecast_condition_name_label
            text: "Loading..."
            x: 15
            y: 252
            text_font: montserrat_18
            text_color: 0xFFFFFF  
        - label:
            id: backyard_temperature_label
            text: "-"
            x: 65
            y: 275
            text_font: montserrat_36
            text_color: 0xFFFFFF  
        - label:
            id: forecast_icon
            text: "?"
            align: TOP_LEFT
            x: 10
            y: 270
            text_font: weather_icons_48
        - label:
            id: aqi_label
            text: "AQI: -"
            align: TOP_MID
            x: -75
            y: 275
            text_font: montserrat_16
        - label:
            id: backyard_humidity_label
            text: "-"
            align: TOP_MID
            x: -75
            y: 295
            text_font: montserrat_16
#        - label:
#            text: "\U000F059D"  # mdi-wind
#            align: TOP_LEFT
#            x: 120
#            y: 293
#            text_font: text_with_icons_18
#            text_color: 0xD9D9D9
#        - label:
#            id: forecast_wind_label
#            text: "- mph"
#            align: TOP_LEFT
#            x: 145
#            y: 293
#            text_font: montserrat_16
#            text_color: 0xD9D9D9

## FORECAST
    ## Day 0 remainder 
        - label:
            text: "Later"
            align: TOP_MID
            x: -15
            y: 225
            text_font: montserrat_20
            text_color: 0xFFFF00  
        - label:
            id: forecast_day_0_date_label
            text: "--"
            align: TOP_MID
            x: -20
            y: 252
            text_font: montserrat_20
            text_color: 0x00FF00
        - label:
            text: "L"
            align: TOP_MID
            x: -10
            y: 275
            text_font: montserrat_14
            text_color: 0xCCCCCC  
        - label:
            text: "\U000F0E0A"   # water drop icon
            align: TOP_MID
            x: -10
            y: 295
            text_font: text_with_icons_18
            text_color: 0x91BCED
        - label:
            id: forecast_high_label
            text: "-"
            align: TOP_MID
            x: 20
            y: 252
            text_font: montserrat_20
            text_color: 0xFFFFFF     
        - label:
            id: forecast_low_label
            text: "-"
            align: TOP_MID
            x: 20
            y: 275
            text_font: montserrat_16
            text_color: 0xCCCCCC  
        - label:
            id: forecast_day_0_precip_inches_label
            text: "-%"
            align: TOP_MID
            x: 20
            y: 295
            text_font: montserrat_16
            text_color: 0x91BCED
    ## Day 1
        - label:
            id: forecast_day_1_date_label
            text: "--"
            align: TOP_MID
            x: 60
            y: 252
            text_font: montserrat_20
            text_color: 0x00FF00
        - label:
            id: forecast_day_1_icon
            text: "?"
            align: TOP_MID
            x: 62
            y: 275
            text_font: weather_icons_40
            text_color: 0xFFFFFF 
        - label:
            id: forecast_day_1_high_label
            text: "-"
            align: TOP_MID
            x: 105
            y: 252
            text_font: montserrat_20
            text_color: 0xFFFFFF  
        - label:
            id: forecast_day_1_low_label
            text: "-"
            align: TOP_MID
            x: 105
            y: 275
            text_font: montserrat_16
            text_color: 0xBFBFBF
        - label:
            id: forecast_day_1_precip_inches_label
            text: "-"
            align: TOP_MID
            x: 105
            y: 295
            text_font: montserrat_16
            text_color: 0x91BCED
            
    ## Day 2
        - label:
            id: forecast_day_2_date_label
            text: "-"
            align: TOP_MID
            x: 155
            y: 252
            text_font: montserrat_20
            text_color: 0x00FF00
        - label:
            id: forecast_day_2_icon
            text: "?"
            align: TOP_MID
            x: 155
            y: 275
            text_font: weather_icons_40
            text_color: 0xFFFFFF 
        - label:
            id: forecast_day_2_high_label
            text: "-"
            align: TOP_MID
            x: 202
            y: 252
            text_font: montserrat_20
            text_color: 0xFFFFFF
        - label:
            id: forecast_day_2_low_label
            text: "-"
            align: TOP_MID
            x: 202
            y: 275
            text_font: montserrat_16
            text_color: 0xBFBFBF
        - label:
            id: forecast_day_2_precip_inches_label
            text: "-"
            align: TOP_MID
            x: 202
            y: 295
            text_font: montserrat_16
            text_color: 0x5094E2   



# Update all values every 10 seconds
interval:
  - interval: 10s
    then:
    # Update time & date
      - lvgl.label.update:
          id: time_display
          text: !lambda |-
            return id(homeassistant_time).now().strftime("%I:%M %p").c_str();
      - lvgl.label.update:
          id: date_display
          text: !lambda |-
            return id(homeassistant_time).now().strftime("%A, %b %d").c_str();
    # AQI value and desc
      - lvgl.label.update:
          id: aqi_label
          text: !lambda |-
            // Set color based on AQI value
            auto label = id(aqi_label);
            float aqi = id(aqi_value).state;
            
            if (aqi <= 50) {
              lv_obj_set_style_text_color(label, lv_color_hex(0x00E400), 0);  // Good - Green
            } else if (aqi <= 100) {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFFD700), 0);  // Moderate - Gold
            } else if (aqi <= 150) {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFF8C00), 0);  // Unhealthy for Sensitive - Orange
            } else if (aqi <= 200) {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFF4444), 0);  // Unhealthy - Red
            } else if (aqi <= 300) {
              lv_obj_set_style_text_color(label, lv_color_hex(0xBB44FF), 0);  // Very Unhealthy - Purple
            } else {
              lv_obj_set_style_text_color(label, lv_color_hex(0xCC2244), 0);  // Hazardous - Maroon
            }
            
            return str_sprintf("AQI: %.0f", aqi);
## RECENT MEDIA GRABS
      - lvgl.label.update:
          id: docky_download_speed_label
          text: !lambda |-
            return str_sprintf("%.0f MB/s", id(docky_download_speed).state);
      - lvgl.label.update:
          id: arr_grab_1_label
          text: !lambda |-
            return id(arr_grab_1).state.c_str();
      - lvgl.label.update:
          id: arr_grab_2_label
          text: !lambda |-
            return id(arr_grab_2).state.c_str();
      - lvgl.label.update:
          id: arr_grab_3_label
          text: !lambda |-
            return id(arr_grab_3).state.c_str();
## CURRENT TEMP/HUMID
      - lvgl.label.update:
          id: backyard_temperature_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(backyard_temperature).state);
      - lvgl.label.update:
          id: backyard_humidity_label
          text: !lambda |-
            return str_sprintf("H: %.0f%%", id(backyard_humidity).state);
          text_color: !lambda |-
            float hum = id(backyard_humidity).state;
            if (hum < 30) return lv_color_hex(0xD2691E);  // chocolate brown - very dry
            if (hum < 45) return lv_color_hex(0xDEB887);  // burlywood - dry
            if (hum < 60) return lv_color_hex(0x87CEEB);  // sky blue - normal
            if (hum < 75) return lv_color_hex(0x4682B4);  // steel blue - wet
            return lv_color_hex(0x1E90FF);                // dodger blue - very wet
      - lvgl.label.update:
          id: living_room_temperature_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(living_room_temperature).state);
          text_color: !lambda |-
            float temp = id(living_room_temperature).state;
            if (temp < 67) return lv_color_hex(0x6666FF);    // blue
            if (temp < 69) return lv_color_hex(0x9999FF);    // blue-gray
            if (temp < 71) return lv_color_hex(0xFFFFFF);    // white
            if (temp < 73) return lv_color_hex(0xFFC266);    // light orange
            return lv_color_hex(0xFF6666);                   // light red
      - lvgl.label.update:
          id: living_room_humidity_label
          text: !lambda |-
            return str_sprintf("%.0f%%", id(living_room_humidity).state);
          text_color: !lambda |-
            float hum = id(living_room_humidity).state;
            if (hum < 30) return lv_color_hex(0xD2691E);  // chocolate brown - very dry
            if (hum < 45) return lv_color_hex(0xDEB887);  // burlywood - dry
            if (hum < 60) return lv_color_hex(0x87CEEB);  // sky blue - normal
            if (hum < 75) return lv_color_hex(0x4682B4);  // steel blue - wet
            return lv_color_hex(0x1E90FF);                // dodger blue - very wet
 # FORECASTS:

      - lvgl.label.update:
          id: forecast_high_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(forecast_high).state);
      - lvgl.label.update:
          id: forecast_low_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(forecast_low).state);
      - lvgl.label.update:
          id: forecast_condition_name_label
          text: !lambda |-
            return id(forecast_condition_name).state.c_str();
#      - lvgl.label.update:
#          id: forecast_wind_label
#          text: !lambda |-
#            return str_sprintf("%.0f mph", id(forecast_current_wind).state);   

# ICON W/ COLORS FOR CURRENT CONDISHUNS      
      - lvgl.label.update:
          id: forecast_icon
          text: !lambda |-
            std::string condition = id(forecast_condition).state;
            auto label = id(forecast_icon);
            
            if (condition == "sunny") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFFD700), 0);  // Gold
              return "\U000F0599";
            } else if (condition == "clear-night") {
              lv_obj_set_style_text_color(label, lv_color_hex(0x87CEEB), 0);  // Sky blue
              return "\U000F0594";
            } else if (condition == "partlycloudy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xAAAAAA), 0);  // Gray
              return "\U000F0595";
            } else if (condition == "cloudy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xAAAAAA), 0);  // Gray
              return "\U000F0590";
            } else if (condition == "rainy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0x4A90E2), 0);  // Blue
              return "\U000F0597";
            } else if (condition == "pouring") {
              lv_obj_set_style_text_color(label, lv_color_hex(0x4A90E2), 0);  // Blue
              return "\U000F0596";
            } else if (condition == "snowy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xE0F7FF), 0);  // Light blue/white
              return "\U000F0598";
            } else if (condition == "snowy-rainy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0x87CEEB), 0);  // Sky blue
              return "\U000F067F";
            } else if (condition == "lightning") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFFFF00), 0);  // Yellow
              return "\U000F0593";
            } else if (condition == "lightning-rainy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFFFF00), 0);  // Yellow
              return "\U000F067E";
            } else if (condition == "fog") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xCCCCCC), 0);  // Light gray
              return "\U000F0591";
            } else if (condition == "hail") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xE0F7FF), 0);  // Light blue/white
              return "\U000F0592";
            } else if (condition == "windy") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xAAAAAA), 0);  // Gray
              return "\U000F059D";
            } else if (condition == "windy-variant") {
              lv_obj_set_style_text_color(label, lv_color_hex(0xAAAAAA), 0);  // Gray
              return "\U000F059E";
            } else {
              lv_obj_set_style_text_color(label, lv_color_hex(0xFFFFFF), 0);  // White
              return "--";
            }    
# ICON W/O COLOR FOR 5D FORECAST

      # Precipitation chance DAY 0
      - lvgl.label.update:
          id: forecast_day_0_precip_inches_label
          text: !lambda |-
            if (isnan(id(forecast_day_0_precip_inches).state)) {
              return "--\"";
            }
            if (id(forecast_day_0_precip_inches).state < 0.2) {
              return "";
            }
            return str_sprintf("%.1f\"", id(forecast_day_0_precip_inches).state);
## DAY 1
      # HIGH/LOW
      - lvgl.label.update:
          id: forecast_day_1_high_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(forecast_day_1_high).state);
      - lvgl.label.update:
          id: forecast_day_1_low_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(forecast_day_1_low).state);
      # ICON
      - lvgl.label.update:
          id: forecast_day_1_icon
          text: !lambda |-
            std::string condition = id(forecast_day_1_condition).state;
            if (condition == "sunny") return "\U000F0599";
            else if (condition == "clear-night") return "\U000F0594";
            else if (condition == "partlycloudy") return "\U000F0595";
            else if (condition == "cloudy") return "\U000F0590";
            else if (condition == "rainy") return "\U000F0597";
            else if (condition == "pouring") return "\U000F0596";
            else if (condition == "snowy") return "\U000F0598";
            else if (condition == "snowy-rainy") return "\U000F067F";
            else if (condition == "lightning") return "\U000F0593";
            else if (condition == "lightning-rainy") return "\U000F067E";
            else if (condition == "fog") return "\U000F0591";
            else if (condition == "hail") return "\U000F0592";
            else if (condition == "windy") return "\U000F059D";
            else if (condition == "windy-variant") return "\U000F059E";
            else return "--";  // Fallback       
      # Precipitation day 1
      - lvgl.label.update:
          id: forecast_day_1_precip_inches_label
          text: !lambda |-
            if (isnan(id(forecast_day_1_precip_inches).state)) {
              return "--\"";
            }
            if (id(forecast_day_1_precip_inches).state < 0.2) {
              return "";
            }
            return str_sprintf("%.1f\"", id(forecast_day_1_precip_inches).state);
## DAY 2
      - lvgl.label.update:
          id: forecast_day_2_high_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(forecast_day_2_high).state);
      - lvgl.label.update:
          id: forecast_day_2_low_label
          text: !lambda |-
            return str_sprintf("%.0f°", id(forecast_day_2_low).state);
      
      - lvgl.label.update:
          id: forecast_day_2_icon
          text: !lambda |-
            std::string condition = id(forecast_day_2_condition).state;
            if (condition == "sunny") return "\U000F0599";
            else if (condition == "clear-night") return "\U000F0594";
            else if (condition == "partlycloudy") return "\U000F0595";
            else if (condition == "cloudy") return "\U000F0590";
            else if (condition == "rainy") return "\U000F0597";
            else if (condition == "pouring") return "\U000F0596";
            else if (condition == "snowy") return "\U000F0598";
            else if (condition == "snowy-rainy") return "\U000F067F";
            else if (condition == "lightning") return "\U000F0593";
            else if (condition == "lightning-rainy") return "\U000F067E";
            else if (condition == "fog") return "\U000F0591";
            else if (condition == "hail") return "\U000F0592";
            else if (condition == "windy") return "\U000F059D";
            else if (condition == "windy-variant") return "\U000F059E";
            else return "--";  // Fallback       
      # Precipitation chance day 2
      - lvgl.label.update:
          id: forecast_day_2_precip_inches_label
          text: !lambda |-
            if (isnan(id(forecast_day_2_precip_inches).state)) {
              return "--\"";
            }
            if (id(forecast_day_2_precip_inches).state < 0.2) {
              return "";
            }
            return str_sprintf("%.1f\"", id(forecast_day_2_precip_inches).state);
## DATES
      - lvgl.label.update:
          id: forecast_day_0_date_label
          text: !lambda |-
            std::string day = id(forecast_day_0_date).state;
            if (day.length() >= 2) {
              day = day.substr(0, 2);
              std::transform(day.begin(), day.end(), day.begin(), ::toupper);
            }
            return day.c_str();
      - lvgl.label.update:
          id: forecast_day_1_date_label
          text: !lambda |-
            std::string day = id(forecast_day_1_date).state;
            if (day.length() >= 2) {
              day = day.substr(0, 2);
              std::transform(day.begin(), day.end(), day.begin(), ::toupper);
            }
            return day.c_str();
      - lvgl.label.update:
          id: forecast_day_2_date_label
          text: !lambda |-
            std::string day = id(forecast_day_2_date).state;
            if (day.length() >= 2) {
              day = day.substr(0, 2);
              std::transform(day.begin(), day.end(), day.begin(), ::toupper);
            }
            return day.c_str();
